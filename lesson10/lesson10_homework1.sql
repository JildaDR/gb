

-- Практическое задание к уроку 10.
-- На БД vk:

-- 1. Проанализировать, какие запросы могут выполняться наиболее
-- часто в процессе работы приложения, и добавить необходимые индексы.

-- создаю индекс для поля head из таблицы posts
-- восстанавливаю исходную структуру таблицы постов и заполняю старыми данными, назначаю внешние ключи
DROP TABLE IF EXISTS `posts`;
CREATE TABLE `posts` (
  `id` int unsigned NOT NULL AUTO_INCREMENT,
  `user_id` int unsigned NOT NULL,
  `community_id` int unsigned DEFAULT NULL,
  `head` varchar(255) DEFAULT NULL,
  `body` text NOT NULL,
  `is_public` tinyint(1) DEFAULT '1',
  `is_archived` tinyint(1) DEFAULT '0',
  `created_at` datetime DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=159 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


LOCK TABLES `posts` WRITE;
INSERT INTO `posts` VALUES (32,81,NULL,'Voluptatem','Voluptatem eos animi minima ipsum. Modi provident architecto ratione consequatur iste doloribus. Beatae voluptate itaque omnis repellat.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(33,84,NULL,'Repellat','Repellat iste facere labore cum fuga odit in. Soluta accusantium dolores totam accusamus accusamus quia. In explicabo blanditiis eveniet tenetur. Itaque et pariatur voluptate distinctio quos qui. Vel perspiciatis dolor suscipit sunt et.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(34,13,NULL,'Omnis','Omnis velit ea cumque quam quo necessitatibus. Reprehenderit minima a nostrum nostrum quas. Voluptates et ullam et quae cumque ut.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(35,89,NULL,'Quo','Quo dolorem non amet non. Suscipit et natus totam exercitationem. Illo qui ipsam iusto dolorem sit voluptatibus quidem amet. Vel eum est mollitia quis vel enim ut.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(36,46,NULL,'Odio','Odio pariatur officiis ut suscipit maiores atque. Sunt veniam quas facilis eveniet suscipit. Quia at consequatur quod minima molestias.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(37,5,NULL,'Reprehenderit','Reprehenderit non magnam debitis. Doloribus ratione velit et. Expedita est ipsa ipsa quas quo eligendi. Provident impedit velit consequatur et ea aliquid repellendus. Nam sit ipsum illum omnis.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(38,76,NULL,'Qui','Qui est distinctio assumenda et exercitationem cum reiciendis. Reprehenderit non sapiente ullam. Nisi laborum sit natus ut et.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(39,1,NULL,'Reiciendis','Reiciendis laboriosam debitis excepturi. Minus esse quo beatae soluta. Quia doloremque voluptatem repellendus praesentium aut cumque facere. Vero qui necessitatibus est tempora corporis.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(40,25,NULL,'Quasi','Quasi neque vel veritatis quis eum. Dolorum rerum ducimus magnam voluptatem. Voluptate nemo provident quisquam incidunt. Voluptatem repellendus illo incidunt ipsa neque tenetur.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(41,17,NULL,'Totam','Totam voluptas et est reiciendis. Ut deleniti modi nesciunt veritatis aliquid. Doloremque eos nihil et quaerat et ratione aliquid repellat. Eius repellendus saepe nesciunt ab.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(42,67,NULL,'Ipsa','Ipsa esse quos dolores perspiciatis quaerat. Corrupti non ducimus repellat libero. Dolorem modi accusantium velit vel distinctio tempore et.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(43,14,NULL,'Rerum','Rerum tempore dolorum sequi voluptatum rerum in. Voluptas inventore repudiandae excepturi cum sunt voluptas commodi. Velit pariatur est quo reprehenderit. Distinctio voluptatibus cumque atque molestias inventore.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(44,48,NULL,'Similique','Similique nemo esse aut consequatur praesentium veniam eum ratione. Voluptas laborum sint voluptas sit. Recusandae facere quis perspiciatis vel ut qui. Et debitis est veniam itaque dolorem fuga.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(45,99,NULL,'Praesentium','Praesentium ipsa natus accusamus omnis porro. Voluptate illo et veniam qui et. Id magni nostrum dolor explicabo similique ducimus itaque est. Impedit iusto sit voluptate.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(46,4,NULL,'Aspernatur','Aspernatur ut et facere autem dolore repudiandae et. Dicta sunt rem dolores repellat et consequuntur voluptas illum. Dolorem autem unde quasi facere et eum. Numquam quo molestiae ipsum in ullam provident corporis. Reprehenderit quos incidunt qui asperiores culpa.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(47,98,NULL,'Repellat','Repellat iste facere labore cum fuga odit in. Soluta accusantium dolores totam accusamus accusamus quia. In explicabo blanditiis eveniet tenetur. Itaque et pariatur voluptate distinctio quos qui. Vel perspiciatis dolor suscipit sunt et.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(48,85,NULL,'Quas','Quas quaerat quia voluptas et non. Quidem commodi earum et quisquam. Porro maiores accusantium rem veritatis quasi culpa reprehenderit.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(49,54,NULL,'Et','Et nihil ipsam et occaecati suscipit est. Perferendis ut sed molestiae ab tempora. Voluptatem totam ut vel odit et animi minima. Quae quibusdam sunt ab ipsam iusto distinctio.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(50,40,NULL,'Quasi','Quasi neque vel veritatis quis eum. Dolorum rerum ducimus magnam voluptatem. Voluptate nemo provident quisquam incidunt. Voluptatem repellendus illo incidunt ipsa neque tenetur.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(51,55,NULL,'Velit','Velit sed non adipisci soluta voluptas pariatur consequatur. Quis cum tempore quis. Impedit veniam accusantium omnis ducimus hic. Rem ullam necessitatibus exercitationem a.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(52,94,NULL,'Expedita','Expedita neque reiciendis sit molestias. Ad qui velit ratione hic. Praesentium quidem illum maiores et est.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(53,54,NULL,'Quis','Quis et ut consequatur ipsa ut et dolor et. Aut itaque voluptas maxime distinctio voluptas. Id necessitatibus dicta consequatur velit consectetur debitis est.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(54,31,NULL,'Sunt','Sunt veniam ad non soluta vero dicta rerum. Ut eos quia molestiae rerum mollitia molestias animi. Blanditiis consequuntur aut tempore aut. Voluptas unde adipisci facilis.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(55,59,NULL,'Consequatur','Consequatur incidunt nisi rerum assumenda debitis vero voluptas ab. Quasi ipsum repellat natus quia omnis dicta dolores maxime. Nihil quia et ad odit quasi voluptas quis tempora.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(56,51,NULL,'Autem','Autem rerum et omnis rerum blanditiis facilis. Aut ut voluptas ut ut et facere sint dolores. Quia est ut libero cupiditate optio. Eaque vel natus vitae illum nisi velit alias.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(57,75,NULL,'Autem','Autem rerum et omnis rerum blanditiis facilis. Aut ut voluptas ut ut et facere sint dolores. Quia est ut libero cupiditate optio. Eaque vel natus vitae illum nisi velit alias.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(58,51,NULL,'Reiciendis','Reiciendis laboriosam debitis excepturi. Minus esse quo beatae soluta. Quia doloremque voluptatem repellendus praesentium aut cumque facere. Vero qui necessitatibus est tempora corporis.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(59,43,NULL,'Velit','Velit sed non adipisci soluta voluptas pariatur consequatur. Quis cum tempore quis. Impedit veniam accusantium omnis ducimus hic. Rem ullam necessitatibus exercitationem a.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(60,8,NULL,'Rerum','Rerum rerum est non. Omnis consequuntur voluptatem deleniti et cupiditate natus. Consequatur veniam quibusdam non cumque ut inventore earum ut.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(61,90,NULL,'Atque','Atque molestias distinctio enim qui vel minus. Et sint optio maxime eum illo ratione. Reiciendis in vitae maiores adipisci aperiam quae. Ut molestias dolore rerum.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(62,66,NULL,'Id','Id voluptatum voluptates non quam rem occaecati. Consequuntur debitis commodi pariatur eius quisquam dolores. Aut qui commodi aliquid quae.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(63,2,NULL,'Incidunt','Incidunt ut molestias est modi ad. Vel voluptatum quidem et voluptas quasi quae maxime doloremque. Aut eos qui et consequatur.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(64,12,NULL,'Atque','Atque molestias distinctio enim qui vel minus. Et sint optio maxime eum illo ratione. Reiciendis in vitae maiores adipisci aperiam quae. Ut molestias dolore rerum.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(65,32,NULL,'Odio','Odio pariatur officiis ut suscipit maiores atque. Sunt veniam quas facilis eveniet suscipit. Quia at consequatur quod minima molestias.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(66,87,NULL,'Ut','Ut quas esse voluptas molestiae. Facilis voluptatum molestiae omnis et aut. Ut explicabo perferendis explicabo perspiciatis est voluptas est. Sit ut sunt omnis omnis non.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(67,92,NULL,'Rerum','Rerum vero aut porro illum magnam. Maiores eligendi quaerat neque mollitia ipsam. Quo autem et dicta. Exercitationem eligendi optio voluptatibus sapiente tempore.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(68,59,NULL,'Omnis','Omnis velit ea cumque quam quo necessitatibus. Reprehenderit minima a nostrum nostrum quas. Voluptates et ullam et quae cumque ut.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(69,17,NULL,'Modi','Modi sed dolorum voluptas saepe. Architecto sed ut iusto quas vel. Omnis in eius pariatur deleniti et velit. Minus aut voluptatem repellat provident aliquam.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(70,47,NULL,'Vero','Vero voluptas dolorum odit dolor non consequatur maiores. Natus sed aut et nobis cumque numquam. Dolore quo voluptatem a ea consequatur sit. Omnis error excepturi exercitationem voluptatum dolores cupiditate similique.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(71,6,NULL,'Nisi','Nisi natus veritatis consequatur qui omnis. Veritatis occaecati et temporibus reprehenderit doloribus ipsam ut. Amet illum in ea ut a doloribus voluptatum.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(72,70,NULL,'Accusamus','Accusamus voluptatem totam facere est dicta delectus id nobis. Vitae dolor et nulla suscipit. Eos et est minima ex.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(73,32,NULL,'Consectetur','Consectetur vel eum cum unde est neque officiis. Nostrum et voluptas dolorem modi non libero ullam. Quos ratione necessitatibus quo tenetur mollitia est quo.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(74,52,NULL,'Aut','Aut quia excepturi odio autem. Dolores autem est amet autem quia quo laboriosam. Voluptas aspernatur fugiat blanditiis velit iure sunt.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(75,8,NULL,'Et','Et ad a ratione. Dicta voluptate vero aspernatur dicta. Fugiat repellendus vitae porro qui qui.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(76,73,NULL,'Reiciendis','Reiciendis laboriosam debitis excepturi. Minus esse quo beatae soluta. Quia doloremque voluptatem repellendus praesentium aut cumque facere. Vero qui necessitatibus est tempora corporis.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(77,47,NULL,'Quia','Quia ut blanditiis dolor. Quia sunt unde aspernatur rem. Ullam fugiat tempore at pariatur harum rerum ipsa. Quo sint error ipsam laborum quidem doloribus.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(78,64,NULL,'Consectetur','Consectetur vel eum cum unde est neque officiis. Nostrum et voluptas dolorem modi non libero ullam. Quos ratione necessitatibus quo tenetur mollitia est quo.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(79,6,NULL,'Et','Et nihil ipsam et occaecati suscipit est. Perferendis ut sed molestiae ab tempora. Voluptatem totam ut vel odit et animi minima. Quae quibusdam sunt ab ipsam iusto distinctio.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(80,37,NULL,'Nemo','Nemo nulla quia ipsum exercitationem ex aspernatur. Debitis qui delectus ut tenetur accusantium dolor rerum. Et eligendi quas qui eveniet voluptate.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(81,8,NULL,'Accusamus','Accusamus voluptatem totam facere est dicta delectus id nobis. Vitae dolor et nulla suscipit. Eos et est minima ex.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(82,5,NULL,'Earum','Earum vero necessitatibus inventore velit non tenetur reiciendis. Laboriosam impedit voluptatem praesentium similique cum in. Qui corrupti odio debitis laboriosam.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(83,24,NULL,'Ut','Ut optio et et qui. Qui fuga molestiae sequi aut harum voluptates vitae et. Libero et labore aut et ut. Aut nam enim soluta.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(84,92,NULL,'Quo','Quo dolorem non amet non. Suscipit et natus totam exercitationem. Illo qui ipsam iusto dolorem sit voluptatibus quidem amet. Vel eum est mollitia quis vel enim ut.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(85,87,NULL,'Et','Et neque voluptates quia voluptatum corporis qui aut. Vero possimus ut et. Accusantium molestiae asperiores sed voluptatibus.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(86,11,NULL,'Veritatis','Veritatis et doloremque iste iure dicta eius. Sit doloribus ab sit ut commodi numquam veritatis. Esse sed eius voluptas qui.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(87,37,NULL,'Eligendi','Eligendi soluta nesciunt nihil. Porro consequatur ex voluptatibus qui iusto similique tenetur sit.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(88,89,NULL,'Maxime','Maxime tempora provident quasi et. Quia sit quas esse minima culpa.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(89,86,NULL,'Repellat','Repellat iste facere labore cum fuga odit in. Soluta accusantium dolores totam accusamus accusamus quia. In explicabo blanditiis eveniet tenetur. Itaque et pariatur voluptate distinctio quos qui. Vel perspiciatis dolor suscipit sunt et.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(90,32,NULL,'Consectetur','Consectetur vel eum cum unde est neque officiis. Nostrum et voluptas dolorem modi non libero ullam. Quos ratione necessitatibus quo tenetur mollitia est quo.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(91,53,NULL,'Quae','Quae aut et aut ut. Velit voluptatem et labore suscipit expedita rerum sunt voluptatem.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(92,42,NULL,'Voluptatum','Voluptatum autem et deleniti consequatur praesentium porro. Saepe sunt consequatur sequi eos. Distinctio quisquam repellendus occaecati ipsam totam. Quos nihil et sequi ut.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(93,46,NULL,'Ut','Ut tempora explicabo possimus vero nobis explicabo. Ut voluptates qui beatae omnis similique nulla. Est qui voluptatem quasi. Quam sit vitae omnis corrupti exercitationem.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(94,23,NULL,'Rerum','Rerum molestias voluptas nostrum dolores. Eum et cumque dolores maxime et. Quae est fuga quaerat provident. Qui similique aspernatur ea quam maiores voluptate assumenda sed.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(95,52,NULL,'Id','Id alias nostrum voluptas provident quis quae est. In atque doloremque recusandae dolorem modi. Voluptate voluptates ducimus et voluptatum voluptas. Repellendus temporibus est fugiat vel.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(96,54,NULL,'Aspernatur','Aspernatur ut et facere autem dolore repudiandae et. Dicta sunt rem dolores repellat et consequuntur voluptas illum. Dolorem autem unde quasi facere et eum. Numquam quo molestiae ipsum in ullam provident corporis. Reprehenderit quos incidunt qui asperiores culpa.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(97,1,NULL,'Enim','Enim cumque et quas quibusdam ut velit. Eum quidem incidunt velit minima est. Dicta expedita eaque quam sunt. Autem ullam voluptatibus dolorem ut.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(98,76,NULL,'Consequatur','Consequatur corrupti quis assumenda. Consequatur qui corrupti pariatur voluptatem sit ad. Asperiores autem consequatur velit voluptatum repellat eum nisi.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(99,70,NULL,'Maxime','Maxime eaque cupiditate voluptate et fugit vel. Quos libero sit et error eaque nihil dolores. Dolor odit ipsam aut pariatur explicabo vel. Sit ipsam dolorem est iusto voluptates laboriosam. Eum sapiente omnis aliquam voluptas fugiat sed rem.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(100,77,NULL,'Voluptatem','Voluptatem eos animi minima ipsum. Modi provident architecto ratione consequatur iste doloribus. Beatae voluptate itaque omnis repellat.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(101,32,NULL,'Consectetur','Consectetur neque alias molestias rerum quasi voluptatum. Ea sint nemo sed omnis odit sint. Voluptatem autem autem adipisci dolor unde exercitationem facere. Maiores dignissimos ut dolor enim rerum. Est doloribus suscipit architecto nobis.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(102,90,NULL,'Enim','Enim cumque et quas quibusdam ut velit. Eum quidem incidunt velit minima est. Dicta expedita eaque quam sunt. Autem ullam voluptatibus dolorem ut.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(103,27,NULL,'Autem','Autem rerum et omnis rerum blanditiis facilis. Aut ut voluptas ut ut et facere sint dolores. Quia est ut libero cupiditate optio. Eaque vel natus vitae illum nisi velit alias.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(104,31,NULL,'Quaerat','Quaerat hic itaque porro accusamus aut eum fugit. Dolores laboriosam fugiat voluptas tenetur quas atque. Laudantium accusantium vitae qui veritatis. Nihil autem adipisci voluptates. Quis delectus et rerum officiis quos assumenda vitae.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(105,39,NULL,'Velit','Velit sed non adipisci soluta voluptas pariatur consequatur. Quis cum tempore quis. Impedit veniam accusantium omnis ducimus hic. Rem ullam necessitatibus exercitationem a.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(106,79,NULL,'Rem','Rem libero sed quia facere expedita cum quas fuga. Distinctio assumenda sapiente quasi asperiores ut. Quia qui sunt omnis repudiandae. Rem aliquid recusandae et a.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(107,50,NULL,'Dignissimos','Dignissimos blanditiis voluptates unde sunt autem nihil. Ut quis sequi sit et. Cumque omnis et quaerat natus soluta. Voluptatum cumque ex totam sit quos voluptates. Rerum qui aut et cupiditate nihil exercitationem.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(108,66,NULL,'Autem','Autem rerum et omnis rerum blanditiis facilis. Aut ut voluptas ut ut et facere sint dolores. Quia est ut libero cupiditate optio. Eaque vel natus vitae illum nisi velit alias.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(109,41,NULL,'Ea','Ea numquam id occaecati voluptas ut autem. Eos consequatur deleniti similique ducimus eos veritatis. Temporibus ea sit velit eaque et pariatur. Quam omnis minima dolorem rerum.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(110,62,NULL,'Maxime','Maxime tempora provident quasi et. Quia sit quas esse minima culpa.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(111,12,NULL,'Quas','Quas qui aperiam quod animi. Veniam officiis quo omnis. Facere repellendus voluptas nemo eum iure quae ut enim.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(112,22,NULL,'Perferendis','Perferendis doloremque eaque accusamus quos beatae aliquam. Tempora dignissimos possimus expedita consequuntur. Dolor at et quam vel odit sed voluptas.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(113,61,NULL,'Velit','Velit ullam ad laborum officia ut at sed. Ut vitae culpa adipisci est cupiditate doloremque enim. Magni consectetur vitae voluptas facere impedit et. Sit repellendus quo sequi nesciunt labore a in.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(114,3,NULL,'Aspernatur','Aspernatur ut et facere autem dolore repudiandae et. Dicta sunt rem dolores repellat et consequuntur voluptas illum. Dolorem autem unde quasi facere et eum. Numquam quo molestiae ipsum in ullam provident corporis. Reprehenderit quos incidunt qui asperiores culpa.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(115,78,NULL,'Sit','Sit maxime officiis et dolorem dolorum dolor nihil. Molestiae repudiandae aut molestiae corporis sapiente totam. Esse aut ad ut.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(116,84,NULL,'Consequatur','Consequatur corrupti quis assumenda. Consequatur qui corrupti pariatur voluptatem sit ad. Asperiores autem consequatur velit voluptatum repellat eum nisi.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(117,97,NULL,'Numquam','Numquam quae laborum et. Dolores exercitationem non delectus nemo consequatur pariatur enim distinctio. In autem consequatur qui ipsa reiciendis libero. Nesciunt et autem modi est.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(118,82,NULL,'Quo','Quo dolorem non amet non. Suscipit et natus totam exercitationem. Illo qui ipsam iusto dolorem sit voluptatibus quidem amet. Vel eum est mollitia quis vel enim ut.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(119,100,NULL,'Voluptatem','Voluptatem eos animi minima ipsum. Modi provident architecto ratione consequatur iste doloribus. Beatae voluptate itaque omnis repellat.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(120,90,NULL,'Dignissimos','Dignissimos blanditiis voluptates unde sunt autem nihil. Ut quis sequi sit et. Cumque omnis et quaerat natus soluta. Voluptatum cumque ex totam sit quos voluptates. Rerum qui aut et cupiditate nihil exercitationem.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(121,57,NULL,'Velit','Velit ullam ad laborum officia ut at sed. Ut vitae culpa adipisci est cupiditate doloremque enim. Magni consectetur vitae voluptas facere impedit et. Sit repellendus quo sequi nesciunt labore a in.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(122,98,NULL,'Omnis','Omnis velit ea cumque quam quo necessitatibus. Reprehenderit minima a nostrum nostrum quas. Voluptates et ullam et quae cumque ut.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(123,40,NULL,'Velit','Velit nihil adipisci fugiat sed quam ut quaerat. Cupiditate numquam eos eveniet itaque qui corrupti voluptatum qui. Enim sunt impedit laboriosam aut veniam et officiis. Est eos sit voluptas dolor. Consectetur veniam tempora nihil est quaerat.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(124,91,NULL,'Similique','Similique nemo esse aut consequatur praesentium veniam eum ratione. Voluptas laborum sint voluptas sit. Recusandae facere quis perspiciatis vel ut qui. Et debitis est veniam itaque dolorem fuga.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(125,40,NULL,'Praesentium','Praesentium ipsa natus accusamus omnis porro. Voluptate illo et veniam qui et. Id magni nostrum dolor explicabo similique ducimus itaque est. Impedit iusto sit voluptate.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(126,90,NULL,'Voluptatem','Voluptatem eos animi minima ipsum. Modi provident architecto ratione consequatur iste doloribus. Beatae voluptate itaque omnis repellat.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(127,96,NULL,'Quo','Quo dolorem non amet non. Suscipit et natus totam exercitationem. Illo qui ipsam iusto dolorem sit voluptatibus quidem amet. Vel eum est mollitia quis vel enim ut.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(128,15,NULL,'Sunt','Sunt esse doloribus enim quod veniam aspernatur voluptatem. Rem aut at assumenda suscipit aut. Incidunt porro rem et.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(129,79,NULL,'Libero','Libero quia ut sit numquam officia ut. Maxime nam sunt aut nemo. Quasi molestiae dolorum laudantium et. Mollitia quia vero eum et dolores sit sed error.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(130,53,NULL,'Eum','Eum cupiditate ut quisquam temporibus incidunt rem sapiente iure. Esse corrupti dolorem sunt. Magnam nostrum temporibus soluta aspernatur dolorem. Dolore nulla amet quaerat eos animi commodi omnis. Molestiae rerum dolores fuga hic.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07'),(131,89,NULL,'Accusamus','Accusamus voluptatem totam facere est dicta delectus id nobis. Vitae dolor et nulla suscipit. Eos et est minima ex.',1,0,'2021-03-18 18:11:07','2021-03-18 18:11:07');
UNLOCK TABLES;


 ALTER TABLE posts
     ADD CONSTRAINT posts_fk_user_id 
    FOREIGN KEY (user_id) REFERENCES users(id),
  ADD CONSTRAINT posts_fk_community_id
    FOREIGN KEY (community_id) REFERENCES communities(id); 

   -- проверяю cost без индекса-> Filter: (posts.head = 'Dignissimos')  (cost=10.75 rows=10) (actual time=0.081..0.099 rows=2 loops=1)

EXPLAIN ANALYZE
SELECT * FROM posts WHERE head = 'Dignissimos';
   
   -- создаю индекс на поле head
CREATE INDEX posts_head_idx ON posts(head);   

   -- проверяю cost с индексом -> Index lookup on posts using posts_head_idx (head='Dignissimos')  (cost=0.70 rows=2) (actual time=0.022..0.028 rows=2 loops=1)

EXPLAIN ANALYZE
SELECT * FROM posts WHERE head = 'Dignissimos';


-- создаю индекс на поля first_name, last_name из таблицы profiles
CREATE INDEX profiles_fn_ln_idx ON profiles(first_name, last_name);  


-- 2. Задание на оконные функции
-- Построить запрос, который будет выводить следующие столбцы:
-- имя группы
-- среднее количество пользователей в группах
-- самый молодой пользователь в группе
-- самый старший пользователь в группе
-- общее количество пользователей в группе
-- всего пользователей в системе
-- отношение в процентах (общее количество пользователей в группе / всего пользователей в системе) * 100


-- не понимаю, как создать запрос с avg


SELECT DISTINCT c.id, c.name group_name,
max(p.birthday) OVER w AS youngest_user,
min(p.birthday) OVER w AS oldest_user,
count(cu.user_id) OVER w AS users_per_group,
count(cu.user_id) OVER () AS total_users,
count(cu.user_id) OVER w / count(cu.user_id) OVER () * 100 AS "%"
FROM communities c
JOIN communities_users cu ON c.id = cu.community_id
JOIN profiles p ON cu.user_id = p.user_id
WINDOW w AS (PARTITION BY c.id)
ORDER BY c.id
;


